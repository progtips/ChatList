# План реализации функции "AI-ассистент для улучшения промтов"

## Этап 1: Подготовка модуля для улучшения промтов

1.1. Создать модуль `prompt_assistant.py`:
- Класс `PromptAssistant` для работы с улучшением промтов
- Метод `improve_prompt(prompt: str, model: Model) -> Dict` - отправка запроса на улучшение
- Метод `generate_variants(prompt: str, model: Model) -> List[str]` - генерация вариантов переформулировки
- Метод `adapt_for_model_type(prompt: str, model_type: str, model: Model) -> str` - адаптация под тип модели

1.2. Создать промпты-шаблоны для разных задач:
- Шаблон для общего улучшения промта
- Шаблон для генерации вариантов переформулировки
- Шаблоны для адаптации под типы моделей (код, анализ, креатив)

1.3. Интеграция с существующими модулями:
- Использование `models.py` для работы с моделями
- Использование `network.py` для отправки запросов
- Обработка ошибок и таймаутов

## Этап 2: Реализация логики улучшения промтов

2.1. Реализовать метод улучшения промта:
- Формирование промпта для AI-модели с инструкциями по улучшению
- Отправка запроса через существующий клиент OpenRouter
- Парсинг ответа и извлечение улучшенной версии
- Обработка различных форматов ответов от разных моделей

2.2. Реализовать генерацию вариантов переформулировки:
- Формирование промпта для генерации 2-3 вариантов
- Парсинг ответа с извлечением всех вариантов
- Валидация и очистка вариантов

2.3. Реализовать адаптацию под типы моделей:
- Определение типа модели (код, анализ, креатив)
- Применение соответствующего шаблона адаптации
- Генерация адаптированной версии промта

2.4. Добавить кэширование результатов:
- Сохранение результатов улучшения для одинаковых промтов
- Опциональное использование кэша для ускорения работы

## Этап 3: Создание диалогового окна улучшения промтов

3.1. Создать класс `PromptImprovementDialog`:
- Отображение исходного промта
- Отображение улучшенной версии
- Отображение альтернативных вариантов (2-3 штуки)
- Кнопки для выбора и подстановки варианта

3.2. Реализовать UI элементы:
- Область для исходного промта (read-only)
- Область для улучшенного промта с возможностью редактирования
- Список альтернативных вариантов с возможностью выбора
- Кнопка "Подставить в поле ввода" для выбранного варианта
- Кнопка "Копировать" для каждого варианта
- Индикатор загрузки при обработке

3.3. Добавить настройки диалога:
- Выбор модели для улучшения (выпадающий список активных моделей)
- Опция "Адаптировать под тип модели"
- Опция "Генерировать варианты переформулировки"

## Этап 4: Интеграция в главное окно

4.1. Добавить кнопку "Улучшить промт":
- Разместить рядом с полем ввода промта
- Активировать только при наличии текста в поле ввода
- Показывать индикатор загрузки при обработке

4.2. Реализовать обработчик кнопки:
- Получение текста из поля ввода
- Открытие диалога улучшения промтов
- Передача исходного промта в диалог
- Обработка результата (подстановка выбранного варианта)

4.3. Добавить контекстное меню:
- Правый клик по полю ввода промта
- Пункт меню "Улучшить промт"
- Быстрый доступ к функции улучшения

## Этап 5: Обработка ответов AI и парсинг результатов

5.1. Реализовать парсинг ответов:
- Извлечение улучшенной версии промта из ответа модели
- Извлечение вариантов переформулировки (если запрашивались)
- Обработка различных форматов ответов (JSON, Markdown, простой текст)

5.2. Добавить валидацию результатов:
- Проверка, что улучшенный промт не пустой
- Проверка качества улучшения (минимальная длина, наличие смысла)
- Обработка случаев, когда модель вернула некорректный ответ

5.3. Реализовать форматирование ответов:
- Разметка вариантов для удобного отображения
- Подсветка изменений (если возможно)
- Нумерация альтернативных вариантов

## Этап 6: Сохранение истории улучшений (опционально)

6.1. Расширить схему БД (опционально):
- Таблица `prompt_improvements` для хранения истории улучшений
- Поля: original_prompt, improved_prompt, model_used, created_at
- Связь с таблицей prompts (опционально)

6.2. Реализовать сохранение улучшений:
- Автоматическое сохранение при использовании функции
- Возможность просмотра истории улучшений
- Возможность повторного использования сохраненных улучшений

## Этап 7: Оптимизация и улучшение UX

7.1. Добавить асинхронную обработку:
- Использование QThread для отправки запросов
- Неблокирующий интерфейс во время обработки
- Возможность отмены запроса

7.2. Улучшить обратную связь:
- Прогресс-бар при обработке
- Информативные сообщения об ошибках
- Подсказки по использованию функции

7.3. Добавить настройки:
- Выбор модели по умолчанию для улучшения
- Настройка количества вариантов переформулировки
- Включение/выключение адаптации под типы моделей

## Этап 8: Тестирование

8.1. Тестирование модуля `prompt_assistant.py`:
- Проверка улучшения различных типов промтов
- Проверка генерации вариантов
- Проверка адаптации под типы моделей
- Обработка ошибок API

8.2. Тестирование UI:
- Проверка работы диалога улучшения
- Проверка подстановки вариантов в поле ввода
- Проверка работы с разными моделями
- Проверка обработки длинных промтов

8.3. Интеграционное тестирование:
- Полный цикл улучшения промта
- Использование улучшенного промта для отправки запросов
- Сохранение и загрузка истории (если реализовано)

## Этап 9: Документация и финализация

9.1. Добавить документацию:
- Описание функции в README.md
- Примеры использования
- Рекомендации по выбору модели для улучшения

9.2. Обновить интерфейс:
- Добавить подсказки в UI
- Улучшить визуальное оформление диалога
- Добавить иконки для кнопок (опционально)

9.3. Финальная проверка:
- Проверка работы на разных моделях
- Проверка производительности
- Оптимизация запросов к API

