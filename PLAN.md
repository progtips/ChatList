# План реализации программы ChatList

## Этап 1: Подготовка окружения и структуры проекта

1.1. Создать структуру проекта:
- `db.py` - модуль работы с базой данных
- `models.py` - логика работы с моделями нейросетей
- `network.py` - отправка HTTP-запросов к API
- `main.py` - основной GUI интерфейс
- `config.py` - конфигурация и загрузка переменных окружения
- `.env` - файл с API-ключами (в .gitignore)

1.2. Обновить `requirements.txt`:
- PyQt5
- requests или httpx
- python-dotenv (для работы с .env)
- pyinstaller (для сборки)

1.3. Создать `.env.example` с примерами переменных окружения

## Этап 2: Реализация модуля базы данных (db.py)

2.1. Создать класс `Database` для работы с SQLite:
- Метод инициализации БД (создание таблиц при первом запуске)
- Методы для работы с таблицей `prompts`:
  - `create_prompt()` - создание нового промта
  - `get_prompts()` - получение списка промтов (с поиском и сортировкой)
  - `get_prompt_by_id()` - получение промта по ID
  - `update_prompt()` - обновление промта
  - `delete_prompt()` - удаление промта

2.2. Методы для работы с таблицей `models`:
- `create_model()` - добавление новой модели
- `get_active_models()` - получение активных моделей
- `get_all_models()` - получение всех моделей
- `update_model()` - обновление модели
- `toggle_model_active()` - переключение активности модели
- `delete_model()` - удаление модели

2.3. Методы для работы с таблицей `results`:
- `save_result()` - сохранение одного результата
- `save_results()` - массовое сохранение результатов
- `get_results()` - получение результатов (с поиском и сортировкой)
- `delete_result()` - удаление результата

2.4. Методы для работы с таблицей `settings`:
- `get_setting()` - получение настройки
- `set_setting()` - сохранение настройки

## Этап 3: Реализация модуля работы с моделями (models.py)

3.1. Создать базовый класс `Model`:
- Атрибуты: name, api_url, api_id, api_key_env_var, is_active
- Абстрактный метод `send_request(prompt)` для отправки запроса

3.2. Реализовать классы для разных типов моделей:
- `OpenAIModel` - для OpenAI API
- `DeepSeekModel` - для DeepSeek API
- `GroqModel` - для Groq API
- Каждый класс реализует свой формат запроса и обработку ответа

3.3. Создать фабрику `ModelFactory`:
- Метод `create_model_from_db(model_data)` - создание экземпляра модели из данных БД

## Этап 4: Реализация модуля сетевых запросов (network.py)

4.1. Создать класс `NetworkManager`:
- Метод `send_to_all_models(prompt, models)` - отправка промта во все модели
- Асинхронная или многопоточная обработка запросов
- Обработка ошибок и таймаутов
- Возврат результатов в едином формате

4.2. Реализовать обработку ответов:
- Парсинг JSON-ответов от разных API
- Извлечение текста ответа
- Обработка ошибок API

4.3. Добавить логирование запросов (опционально)

## Этап 5: Реализация GUI интерфейса (main.py)

5.1. Создать главное окно `MainWindow`:
- Область ввода промта (QTextEdit)
- Выпадающий список сохраненных промтов (QComboBox)
- Кнопка "Отправить" (QPushButton)
- Таблица результатов (QTableWidget) с колонками:
  - Чекбокс выбора
  - Название модели
  - Текст ответа
- Кнопка "Сохранить выбранные" (QPushButton)
- Кнопка "Очистить" (QPushButton)

5.2. Реализовать меню и дополнительные окна:
- Меню "Промты" - управление сохраненными промтами
- Меню "Модели" - управление моделями нейросетей
- Меню "Результаты" - просмотр сохраненных результатов
- Меню "Настройки" - настройки программы

5.3. Создать диалоговые окна:
- `PromptDialog` - для создания/редактирования промта
- `ModelDialog` - для добавления/редактирования модели
- `ResultsDialog` - для просмотра сохраненных результатов с поиском и сортировкой

5.4. Реализовать временное хранилище результатов:
- Список словарей в памяти для хранения текущих результатов
- Методы для добавления, очистки и получения результатов

## Этап 6: Интеграция модулей

6.1. Подключить модуль `db.py` к `main.py`:
- Инициализация БД при запуске
- Загрузка списка промтов в выпадающий список
- Сохранение результатов в БД

6.2. Интегрировать `models.py` и `network.py`:
- Загрузка активных моделей из БД
- Отправка запросов через NetworkManager
- Отображение результатов в таблице

6.3. Реализовать обработчики событий:
- Обработчик кнопки "Отправить"
- Обработчик кнопки "Сохранить выбранные"
- Обработчик выбора промта из списка

## Этап 7: Дополнительные функции

7.1. Реализовать поиск и сортировку:
- Поиск в таблице промтов
- Поиск в таблице результатов
- Сортировка по колонкам

7.2. Реализовать экспорт результатов:
- Экспорт в Markdown
- Экспорт в JSON
- Кнопка "Экспорт" в интерфейсе результатов

7.3. Добавить логирование:
- Логирование запросов к API
- Логирование ошибок
- Файл логов или вывод в консоль

## Этап 8: Тестирование и отладка

8.1. Тестирование модуля БД:
- Проверка создания таблиц
- Проверка CRUD операций
- Проверка поиска и сортировки

8.2. Тестирование работы с API:
- Проверка отправки запросов к разным моделям
- Обработка ошибок сети
- Обработка неверных API-ключей

8.3. Тестирование GUI:
- Проверка всех элементов интерфейса
- Проверка обработчиков событий
- Проверка сохранения и загрузки данных

8.4. Интеграционное тестирование:
- Полный цикл работы программы
- Проверка сохранения результатов
- Проверка работы с несколькими моделями

## Этап 9: Оптимизация и финализация

9.1. Оптимизация производительности:
- Оптимизация запросов к БД
- Асинхронная обработка запросов к API
- Кэширование данных где возможно

9.2. Улучшение UX:
- Индикатор загрузки при отправке запросов
- Сообщения об ошибках пользователю
- Подсказки и валидация ввода

9.3. Подготовка к релизу:
- Обновление README.md с инструкциями
- Создание .gitignore
- Подготовка к сборке исполняемого файла

